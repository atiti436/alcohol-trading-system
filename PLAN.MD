# 酒類進口貿易管理系統 — 簡易工作計畫 (PLAN.MD)

**版本**: 2.0
**最後更新**: 2025-09-29
**專案經理**: Gemini

## 團隊怎麼配合
- 你：決定要達成的成果，確認 Gemini 的任務卡後再轉交給工程師。
- Gemini：把你的需求翻成清楚的任務卡，寫好摘要、需要的決策、下一步，並在任務完成後更新狀態。
- Claude：專攻文件與重構。如果任務說明有疑問，要先跟 Gemini 確認後再動手。
- Codex：負責程式實作與測試，完成後留下修改重點與檔案路徑。

## 每輪工作節奏
1. 你把想完成的功能或調整告訴 Gemini。
2. Gemini 用白話寫成任務卡，標註負責人、狀態、下一步，再請你確認。
3. 你把確認過的任務轉給對應的工程師。
4. 工程師回報進度與重點差異，必要時向 Gemini 詢問。
5. Gemini 檢查成果、更新任務狀態與交接紀錄。

## 任務看板（2025-09-30）

### 待處理
#### [P1] T20250929-105｜進貨單編輯功能（進行中 80%）
- 狀態：進行中
- 負責：Claude
- 目的：進貨單建立後要能由管理者補報單、修正識別錯誤；目前沒有編輯入口。
- 已完成：
  - ✅ 建立 PATCH /api/imports/[id] API（更新進貨單）
  - ✅ 建立 DELETE /api/imports/[id] API（刪除進貨單）
  - ✅ 進貨單頁面增加編輯按鈕（只有超級管理員可見）
- 待完成：
  - ⏳ 建立進貨單編輯 Modal 組件
  - ⏳ 實作編輯表單UI
  - ⏳ 串接更新 API
  - ⏳ 增加重新上傳報單功能
- 下一步：完成編輯 Modal 組件與重新上傳報單功能。

#### [P2] T20250929-101｜提醒清單可進入但維持唯讀
- 狀態：未開始
- 負責：Gemini
- 目的：提醒功能現在標示停用，點進去沒內容；「系統設定 → 一般設定」裡的提醒資料至少要能開啟檢視。
- 下一步：Gemini 盤點資料來源與現有頁面 → 提出「唯讀查看」的 UI 流程 → 你確認後交給 Codex 補實作。

#### [P2] T20240927-003｜整理廢棄目錄
- 狀態：未開始
- 負責：Gemini（確認後再指派 Codex）
- 目的：專案裡的 `webapp_new/` 已經停用，避免混淆。
- 下一步：Gemini 先確認是否還有人需要備份 → 若無，請你拍板 → 改指派 Codex 建 PR 刪除。

#### [P2] T20240927-007｜允許只存次要金鑰
- 狀態：未開始
- 負責：Codex
- 目的：讓使用者在主金鑰還沒準備好時，也能先輸入備用金鑰。
- 下一步：Codex 釐清後端 API 需求 → 更新前端與 API → Gemini 驗收使用流程。

### 進行中
- T20250929-105：進貨單編輯功能（Claude，80% 完成）

### 已完成（重點摘錄）
- T20250930-001（Claude，2025-09-30）：修復 NextAuth 用戶建立流程，解決 callback 執行順序問題，新用戶現在可以正常建立。
- T20250930-002（Claude，2025-09-30）：新增用戶刪除功能，包含業務記錄檢查與用戶管理介面更新。
- T20250929-106（Claude，2025-09-30）：修復權限管理與用戶管理同步問題，建立即時統計 API。
- T20250929-104（Claude，2025-09-30）：精簡採購單表單，移除匯率、報單號碼、報關日期欄位，優化業務流程。
- T20250929-109（Codex，2025-09-29）：從備份恢復因框架升級而遺失的前端路由與頁面，修正首頁顯示邏輯。
- T20250929-108（Codex，2025-09-29）：修復用戶停用功能，使其呼叫正確的 API 路徑與請求內文。
- T20250929-102（Codex，2025-09-29）：重構變體系統，將類型改為自由輸入字串，並更新所有相關 API 與文件。
- T20250929-103（Claude，2025-09-29）：修復前端報價頁面，允許選擇零庫存商品並提供視覺警告。
- T20250929-107（Claude，2025-09-29）：分析並執行過時文件的歸檔，整理至 z-archive 目錄。
- T20240927-004（Claude，2025-09-29）：根據最新文件，完整更新專案 README.md。
- T20240927-006（Codex，2024-09-27）：前端設定頁面加入次要金鑰欄位與狀態顯示。
- T20240927-005（Claude，2024-09-27）：修掉 11 個 ESLint 警告，`npm run lint` 現在乾淨。
- T20240927-002（Codex，2024-09-27）：新增 `webapp/src/lib/keys.test.ts`，涵蓋主／次／環境變數三種情境。
- T20240927-001（Codex，2024-09-27）：完成主／次金鑰策略與三層回退，解除 build 阻塞。
- T20240926-002（Codex，2024-09-27）：金鑰改用 AES-256-GCM，加上 CI 密鑰掃描。
- T20240926-001（Gemini, Claude, Codex，2024-09-27）：完成三方系統分析並列出修復計畫。

## 交接備忘
- Gemini：每天收尾時更新任務狀態與「下一步」，並把摘要貼給你確認。
- Claude／Codex：接到任務先回覆「已讀＋初步做法」，避免方向走偏；完成後附上變更總結與檔案路徑。
- 你：覺得計畫不清楚時，直接請 Gemini 補白話摘要或示意圖，再讓工程師動手。
