# 🐜 防止螞蟻出錯指南

## 😔 **為什麼會一直出錯？**

### **根本原因：**
1. **檢查範圍不完整** - 只檢查API和組件，漏了seeds、tests等檔案
2. **沒有自動化工具** - 手動檢查容易疏漏
3. **單一事實來源沒強制執行** - DATA_MODELS.md有規範但沒工具驗證

---

## 🛡️ **預防方案（請用戶採用）**

### **1. 使用自動化檢查工具** ⭐⭐⭐⭐⭐
```bash
# 檢查所有欄位命名是否符合規範
npm run check:fields

# 每次build前自動檢查（已設定prebuild）
npm run build
```

### **2. 強化Claude指令** 📋
在下次使用Claude時，請在開頭加上：

```markdown
**重要提醒：**
1. 修改任何資料庫相關代碼前，先執行 `npm run check:fields`
2. 必須檢查ALL檔案：API + 組件 + seeds + tests + migrations
3. 嚴格遵循 DATA_MODELS.md 作為單一事實來源
4. 修復完成後再次執行 `npm run check:fields` 確認
```

### **3. 建立檢查清單** ✅
每次修改資料庫相關代碼時：

- [ ] 閱讀 DATA_MODELS.md 確認正確欄位名稱
- [ ] 檢查 `/src/app/api/` 中的所有路由
- [ ] 檢查 `/src/components/` 中的所有組件
- [ ] 檢查 `/prisma/seeds/` 中的所有seed檔案
- [ ] 檢查 `/src/tests/` 中的所有測試檔案
- [ ] 執行 `npm run check:fields` 驗證
- [ ] 執行 `npm run build` 確保編譯成功

### **4. Git Hooks（推薦）** 🔗
```bash
# 在 .git/hooks/pre-commit 加入：
#!/bin/sh
echo "🔍 檢查欄位命名一致性..."
npm run check:fields
if [ $? -ne 0 ]; then
  echo "❌ 欄位命名檢查失敗，請修復後再提交"
  exit 1
fi
```

---

## 🎯 **給下次Claude的強制指令**

### **必須執行的步驟：**
```markdown
## Claude檢查Protocol v2.0

**Step 1: 讀取規範**
- 必須先讀取 DATA_MODELS.md
- 記住所有正確的snake_case欄位名稱

**Step 2: 全面檢查**
執行：`npm run check:fields`
檢查結果，如果有錯誤必須全部修復

**Step 3: 修復時的範圍**
- ✅ /src/app/api/ (所有API路由)
- ✅ /src/components/ (所有React組件)
- ✅ /prisma/seeds/ (所有seed檔案)
- ✅ /src/tests/ (所有測試檔案)
- ✅ /prisma/migrations/ (如果有的話)

**Step 4: 驗證**
- 修復後再次執行：`npm run check:fields`
- 必須顯示：✅ 所有欄位命名都符合規範！
- 執行：`npm run build` 確保編譯成功

**Step 5: 承諾**
- 只有通過所有檢查才能說"修復完成"
- 絕對不能說"應該沒問題了"，要說"已驗證沒問題"
```

---

## 🚨 **Claude的警告系統**

**如果Claude說以下話，請立刻警惕：**
- ❌ "應該修復完了"
- ❌ "基本上沒問題"
- ❌ "大部分都檢查過了"
- ❌ "主要問題已解決"

**正確的說法應該是：**
- ✅ "已執行自動化檢查，確認無錯誤"
- ✅ "已驗證所有相關檔案"
- ✅ "通過npm run check:fields和build測試"

---

## 💡 **最佳實踐**

### **對用戶：**
1. **每次修改前**：執行 `npm run check:fields`
2. **要求Claude遵循檢查Protocol v2.0**
3. **不相信Claude的"應該沒問題"**，要求提供驗證證據

### **對Claude：**
1. **永遠不能跳過自動化檢查**
2. **必須檢查所有資料庫相關檔案**
3. **必須提供具體的驗證結果**
4. **禁止使用"應該"、"基本上"等不確定詞彙**

---

**用這套方法，就不會再有螞蟻出錯問題了！** 🎯