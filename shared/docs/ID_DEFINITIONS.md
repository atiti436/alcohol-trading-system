# 核心ID與編碼規則 (Master ID Definitions)

本文件是整個系統唯一識別碼的最高定義，所有AI開發時必須以此為準。

## 1. 客戶 (Customer)

- **ID名稱**: `customer_code`
- **中文名稱**: 客戶代碼 (客代)
- **生成規則**: `C` + 5位數字流水號
- **範例**: `C00001`, `C00002`, `C00999`
- **唯一性**: 必須是系統中唯一的
- **所屬房間**: Room-2 (主檔管理)

## 2. 產品 (Product)

- **ID名稱**: `product_code`
- **中文名稱**: 產品編號 (品號)
- **生成規則**: `P` + 5位數字流水號
- **範例**: `P00001`, `P00002`, `P00999`
- **唯一性**: 必須是系統中唯一的
- **所屬房間**: Room-2 (主檔管理)

### 2.1 產品變體 (Product Variant)

- **ID名稱**: `variant_code`
- **中文名稱**: 變體編號
- **生成規則**: `{product_code}-{variant_type}`
- **變體類型**: `A`(一般版) | `B`(年度限定) | `C`(紀念版) | `D`(特殊限定) | `X`(損傷品)
- **範例**: `P00001-A`, `P00001-X`, `P00002-C`
- **所屬房間**: Room-2 (主檔管理)

### 2.2 庫存單位 (SKU)

- **ID名稱**: `sku`
- **中文名稱**: 庫存單位編號
- **生成規則**: `{product_code}-{volume_ml}-{alc_percentage}`
- **範例**: `P00001-700-43`, `P00002-720-15`
- **說明**: 用於庫存精細化管理
- **所屬房間**: Room-3 (交易核心)

## 3. 採購相關單據

### 3.1 採購單 (Purchase Order)

- **ID名稱**: `purchase_order_number`
- **中文名稱**: 採購單號
- **生成規則**: `PO-` + `YYYYMMDD` + `-` + 3位數字流水號
- **範例**: `PO-20250916-001`, `PO-20250916-002`
- **唯一性**: 每日重置流水號
- **所屬房間**: Room-3 (交易核心)

### 3.2 進貨單 (Goods Receipt)

- **ID名稱**: `goods_receipt_number`
- **中文名稱**: 進貨單號
- **生成規則**: `GR-` + `YYYYMMDD` + `-` + 3位數字流水號
- **範例**: `GR-20250916-001`
- **唯一性**: 每日重置流水號
- **所屬房間**: Room-3 (交易核心)

### 3.3 庫存調撥單 (Inventory Transfer)

- **ID名稱**: `transfer_number`
- **中文名稱**: 調撥單號
- **生成規則**: `TR-` + `YYYYMMDD` + `-` + 3位數字流水號
- **範例**: `TR-20250916-001`
- **唯一性**: 每日重置流水號
- **所屬房間**: Room-3 (交易核心)

## 4. 銷售相關單據

### 4.1 報價單 (Quote)

- **ID名稱**: `quote_number`
- **中文名稱**: 報價單號
- **生成規則**: `QT-` + `YYYYMMDD` + `-` + 3位數字流水號
- **範例**: `QT-20250916-001`
- **唯一性**: 每日重置流水號
- **權限**: 僅超級管理員可見
- **所屬房間**: Room-4 (營收管理)

### 4.2 銷售單 (Sales Order)

- **ID名稱**: `sales_order_number`
- **中文名稱**: 銷售單號
- **生成規則**: `SO-` + `YYYYMMDD` + `-` + 3位數字流水號
- **範例**: `SO-20250916-001`
- **唯一性**: 每日重置流水號
- **所屬房間**: Room-4 (營收管理)

### 4.3 出貨單 (Shipping Document)

- **ID名稱**: `shipping_number`
- **中文名稱**: 出貨單號
- **生成規則**: `SH-` + `YYYYMMDD` + `-` + 3位數字流水號
- **範例**: `SH-20250916-001`
- **唯一性**: 每日重置流水號
- **所屬房間**: Room-5 (報表列印)

### 4.4 退貨單 (Return Note)

- **ID名稱**: `return_number`
- **中文名稱**: 退貨單號
- **生成規則**: `RN-` + `YYYYMMDD` + `-` + 3位數字流水號
- **範例**: `RN-20250916-001`
- **唯一性**: 每日重置流水號
- **所屬房間**: Room-4 (營收管理)

## 5. 財務相關單據

### 5.1 收款單 (Receipt)

- **ID名稱**: `receipt_number`
- **中文名稱**: 收款單號
- **生成規則**: `RC-` + `YYYYMMDD` + `-` + 3位數字流水號
- **範例**: `RC-20250916-001`
- **唯一性**: 每日重置流水號
- **所屬房間**: Room-4 (營收管理)

### 5.2 開支單 (Expense)

- **ID名稱**: `expense_number`
- **中文名稱**: 開支單號
- **生成規則**: `EX-` + `YYYYMMDD` + `-` + 3位數字流水號
- **範例**: `EX-20250916-001`
- **唯一性**: 每日重置流水號
- **所屬房間**: Room-4 (營收管理)

### 5.3 對帳單 (Account Statement)

- **ID名稱**: `statement_number`
- **中文名稱**: 對帳單號
- **生成規則**: `ST-` + `YYYYMM` + `-` + `{customer_code}`
- **範例**: `ST-202509-C00001`
- **說明**: 按月按客戶生成
- **所屬房間**: Room-5 (報表列印)

## 6. 發票相關 (預留)

### 6.1 電子發票 (E-Invoice)

- **ID名稱**: `invoice_number`
- **中文名稱**: 發票號碼
- **生成規則**: 財政部規定格式：2碼英文 + `-` + 8碼數字
- **範例**: `AA-12345678`, `BC-87654321`
- **說明**: 由財政部電子發票整合平台提供，格式固定
- **所屬房間**: Room-5 (報表列印)

## 7. 系統相關編號

### 7.1 報表匯出檔案

- **檔名規則**: `{report_type}_{period}_{timestamp}_{user_role}`
- **範例**: `sales_report_202509_20250916143052_ADMIN.xlsx`
- **說明**: 便於檔案管理和權限追蹤
- **所屬房間**: Room-5 (報表列印)

### 7.2 LINE Bot 對話記錄

- **ID名稱**: `conversation_id`
- **生成規則**: `CONV-` + `YYYYMMDD` + `-` + UUID前8碼
- **範例**: `CONV-20250916-a1b2c3d4`
- **所屬房間**: Room-6 (LINE Bot)

## 8. 批次作業編號

### 8.1 資料匯入批次

- **ID名稱**: `import_batch_id`
- **生成規則**: `IMP-` + `YYYYMMDD` + `-` + `{data_type}` + `-` + 3位序號
- **範例**: `IMP-20250916-PRODUCT-001`
- **所屬房間**: 各房間適用

### 8.2 報表排程任務

- **ID名稱**: `schedule_job_id`
- **生成規則**: `JOB-` + `{schedule_type}` + `-` + UUID前8碼
- **範例**: `JOB-MONTHLY-a1b2c3d4`
- **所屬房間**: Room-5 (報表列印)

---

## 💡 編號規則設計原則

1. **可讀性**: 前綴明確標示單據類型
2. **時序性**: 包含日期便於排序追蹤
3. **唯一性**: 避免重複，確保資料完整性
4. **擴展性**: 預留空間給未來需求
5. **權限性**: 敏感單據僅特定角色可見

---

## ⚠️ 重要提醒

- **所有ID生成規則必須在對應房間實作**
- **跨房間引用ID時請參考此文件**
- **新增ID類型前請先更新此文件**
- **編號格式變更需通知所有相關房間**

---

**最後更新**: 2025/9/16
**維護責任**: 所有房間共同遵守
**變更審核**: 需老闆確認後才可修改